#!/usr/bin/env bash
# ~/cerebro_scripts/rpacman
# RAM-aware wrapper for pacman

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd)"
RAM_BUILD="$SCRIPT_DIR/ram_build.sh"

if [[ $# -eq 0 ]]; then
    echo "Usage: rpacman <pacman-args>"
    exit 1
fi

if [[ "$1" == "-Syu" ]]; then
    echo "[*] Updating system packages (pacman) directly..."
    sudo pacman -Syu --noconfirm
else
    echo "[*] Installing packages via RAM build..."
    TEMP_DIR=$(mktemp -d)
    cd "$TEMP_DIR"

    for PKG in "$@"; do
        sudo pacman -Sw --noconfirm "$PKG"
        PKG_FILE=$(find . -type f -name "*.pkg.tar*" | head -n1)
        if [[ -n "$PKG_FILE" ]]; then
            "$RAM_BUILD" "$PKG_FILE"
        fi
    done
    rm -rf "$TEMP_DIR"
fi
