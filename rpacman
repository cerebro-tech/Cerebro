#!/usr/bin/env bash
# rpacman - Cerebro RAM build wrapper for pacman
set -euo pipefail

SCRIPT_DIR="$HOME/cerebro_scripts"
LOG_DIR="$SCRIPT_DIR/logs"
mkdir -p "$LOG_DIR"

ACTION="$1"
shift || true

RAM_BUILD="$SCRIPT_DIR/ram_build.sh"

echo "[*] rpacman called with action: $ACTION $*"

# Only wrap install/update packages
if [[ "$ACTION" =~ ^(S|Syu|U)$ ]]; then
    echo "[*] Using RAM build for packages..."
    $RAM_BUILD "$@" | tee -a "$LOG_DIR/rpacman.log"
else
    echo "[*] Default pacman call..."
    sudo pacman "$ACTION" "$@"
fi
